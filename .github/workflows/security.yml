name: Security Scan

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  basic-security:
    name: Basic Security Checks
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check for hardcoded secrets
        run: |
          echo "üîç Scanning for potential secrets..."
          if grep -r -i "password\|secret\|key\|token" --include="*.c" --include="*.h" . | grep -v "// Example\|/\*\|printf\|scanf"; then
            echo "‚ö†Ô∏è Potential hardcoded secrets found"
          else
            echo "‚úÖ No hardcoded secrets detected"
          fi

      - name: Buffer overflow detection
        run: |
          echo "üîç Checking for potential buffer overflow patterns..."
          if grep -r "gets\|strcpy\|strcat\|sprintf" --include="*.c" . | grep -v "// Unsafe\|/\* Unsafe\|snprintf\|strncpy\|strncat"; then
            echo "‚ö†Ô∏è Potentially unsafe functions found - review for buffer overflow risks"
          else
            echo "‚úÖ No obvious unsafe function usage detected"
          fi

      - name: Basic static analysis
        run: |
          echo "üîç Running basic static checks..."
          # Check for common issues
          echo "Files analyzed: $(find . -name "*.c" | wc -l)"
          echo "‚úÖ Basic security scan completed"
